---
import { Icon } from "astro-icon/components";

export interface Props {
  currentPage: number;
  totalPages: number;
  basePath?: string; // Default to "/blog"
}

const { currentPage, totalPages, basePath = "/blog" } = Astro.props;

const getPageUrl = (page: number) => {
  if (page === 1) return basePath;
  return `${basePath}/page/${page}`;
};

// Calculate page numbers to show
const getPageNumbers = () => {
  const delta = 2; // Show 2 pages before and after current
  const range: number[] = [];
  const rangeWithDots: (number | string)[] = [];

  for (
    let i = Math.max(2, currentPage - delta);
    i <= Math.min(totalPages - 1, currentPage + delta);
    i++
  ) {
    range.push(i);
  }

  if (currentPage - delta > 2) {
    rangeWithDots.push(1, "...");
  } else {
    rangeWithDots.push(1);
  }

  rangeWithDots.push(...range);

  if (currentPage + delta < totalPages - 1) {
    rangeWithDots.push("...", totalPages);
  } else if (totalPages > 1) {
    rangeWithDots.push(totalPages);
  }

  return rangeWithDots;
};

const pages = getPageNumbers();
---

<nav class="flex items-center justify-center gap-2" aria-label="Pagination">
  <!-- Previous Button -->
  {currentPage > 1 ? (
    <a
      href={getPageUrl(currentPage - 1)}
      class="px-4 py-2 rounded-lg bg-white text-dark border border-gray-300 hover:bg-primary hover:text-white hover:border-primary transition font-semibold flex items-center gap-2"
      aria-label="Previous page"
    >
      <Icon name="bi:chevron-left" class="text-lg" />
      <span class="hidden sm:inline">Previous</span>
    </a>
  ) : (
    <span class="px-4 py-2 rounded-lg bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed font-semibold flex items-center gap-2">
      <Icon name="bi:chevron-left" class="text-lg" />
      <span class="hidden sm:inline">Previous</span>
    </span>
  )}

  <!-- Page Numbers -->
  {pages.map((page) => (
    page === "..." ? (
      <span class="px-4 py-2 text-steel-gray">...</span>
    ) : (
      <a
        href={getPageUrl(page as number)}
        class={`px-4 py-2 rounded-lg font-semibold transition ${
          currentPage === page
            ? "bg-primary text-white border border-primary"
            : "bg-white text-dark border border-gray-300 hover:bg-primary hover:text-white hover:border-primary"
        }`}
        aria-label={`Page ${page}`}
        aria-current={currentPage === page ? "page" : undefined}
      >
        {page}
      </a>
    )
  ))}

  <!-- Next Button -->
  {currentPage < totalPages ? (
    <a
      href={getPageUrl(currentPage + 1)}
      class="px-4 py-2 rounded-lg bg-white text-dark border border-gray-300 hover:bg-primary hover:text-white hover:border-primary transition font-semibold flex items-center gap-2"
      aria-label="Next page"
    >
      <span class="hidden sm:inline">Next</span>
      <Icon name="bi:chevron-right" class="text-lg" />
    </a>
  ) : (
    <span class="px-4 py-2 rounded-lg bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed font-semibold flex items-center gap-2">
      <span class="hidden sm:inline">Next</span>
      <Icon name="bi:chevron-right" class="text-lg" />
    </span>
  )}
</nav>